## 一、什么是负载均衡
- 将负载（工作任务，访问请求）进行平衡、分摊到多个操作单元（服务器，组件）上进行执行。是解决高性能，单点故障（高可用），扩展性（水平伸缩）的终极解决方案。

<br/>

## 二、负载均衡分类
- 负载均衡是要在网络传输中做文章的。常见的实现方式中，主要可以在应用层、传输层、网络层和数据传输层做文章。所以，工作在应用层的负载均衡，我们通常称之为七层负载均衡、工作在传输层的我们称之为四层负载均衡。

#### 2-1
负载均衡服务器对外依然提供一个VIP（虚IP），集群中不同的机器采用相同IP地址，但是机器的MAC地址不一样。当负载均衡服务器接受到请求之后，通过改写报文的目标MAC地址的方式将请求转发到目标机器实现负载均衡。

#### 2-2、三层负载均衡
和二层负载均衡类似，负载均衡服务器对外依然提供一个VIP（虚IP），但是集群中不同的机器采用不同的IP地址。当负载均衡服务器接受到请求之后，根据不同的负载均衡算法，通过IP将请求转发至不同的真实服务器。

#### 2-3、四层负载均衡
四层负载均衡工作在OSI模型的传输层，由于在传输层，只有TCP/UDP协议，这两种协议中除了包含源IP、目标IP以外，还包含源端口号及目的端口号。四层负载均衡服务器在接受到客户端请求后，以后通过修改数据包的地址信息（IP+端口号）将流量转发到应用服务器。

#### 2-4、七层负载均衡
七层负载均衡工作在OSI模型的应用层，应用层协议较多，常用http、radius、dns等。七层负载就可以基于这些协议来负载。这些应用层协议中会包含很多有意义的内容。比如同一个Web服务器的负载均衡，除了根据IP加端口进行负载外，还可根据七层的URL、浏览器类别、语言来决定是否要进行负载均衡。

<br/>

## 三、负载均衡工具
#### 3-1、LVS
LVS（Linux Virtual Server），也就是Linux虚拟服务器, 是一个由章文嵩博士发起的自由软件项目。使用LVS技术要达到的目标是：通过LVS提供的负载均衡技术和Linux操作系统实现一个高性能、高可用的服务器群集，它具有良好可靠性、可扩展性和可操作性。从而以低廉的成本实现最优的服务性能。

- LVS主要用来做四层负载均衡。

#### 3-2、Nginx
是一个网页服务器，它能反向代理HTTP, HTTPS, SMTP, POP3, IMAP的协议链接，以及一个负载均衡器和一个HTTP缓存。

- Nginx主要用来做七层负载均衡。

#### 3-3、HAProxy
是一个使用C语言编写的自由及开放源代码软件，其提供高可用性、负载均衡，以及基于TCP和HTTP的应用程序代理。

- HAProxy主要用来做七层负载均衡。

<br/>

## 四、负载均衡算法
- 负载均衡算法，是一个负载均衡服务器的核心。

#### 4-1、静态负载均衡算法
- **轮询：** 顺序循环将请求一次顺序循环地连接每个服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP 就把其从顺序循环队列中拿出， 不参加下一次的轮询，直到其恢复正常。

- **比率：** 给每个服务器分配一个加权值为比例，根椐这个比例，把用户的请求分配到每个服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP 就把其从服务器队列中拿出，不参加下一次的用户请求的分配, 直到其恢复正常。

- **优先权：** 给所有服务器分组,给每个组定义优先权，BIG-IP 用户的请求，分配给优先级最高的服务器组（在同一组内，采用轮询或比率算法，分配用户的请求）；当最高优先级中所有服务器出现故障，BIG-IP 才将请求送 给次优先级的服务器组。这种方式，实际为用户提供一种热备份的方式。

#### 4-2、动态负载均衡算法
- **最少的连接方式：** 传递新的连接给那些进行最少连接处理的服务器。当 其中某个服务器发生第二到第7 层的故障，BIG-IP 就把其从服务器队列中拿出， 不参加下一次的用户请求的分配, 直到其恢复正常。

- **最快模式：** 传递连接给那些响应最快的服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP 就把其从服务器队列中拿出，不参加下一次的用户请求 的分配，直到其恢复正常。

- **观察模式：** 连接数目和响应时间以这两项的最佳平衡为依据为新的请求选择服务器。当其中某个服务器发生第二到第7 层的故障，BIG-IP就把其从服务器队列 中拿出，不参加下一次的用户请求的分配，直到其恢复正常。

- **预测模式：** BIG-IP利用收集到的服务器当前的性能指标，进行预测分析，选择一台服务器在下一个时间片内，其性能将达到最佳的服务器相应用户的请求。

- **动态性能分配：** BIG-IP 收集到的应用程序和应用服务器的各项性能参数 ，动态调整流量分配。

- **动态服务器补充：** 当主服务器群中因故障导致数量减少时，动态地将 备份服务器补充至主服务器群。

- **服务质量：** 按不同的优先级对数据流进行分配

- **服务类型：** 按不同的服务类型（在Type of Field中标识）负载均衡对 数据流进行分配。

- **规则模式：** 针对不同的数据流设置导向规则，用户可自行。
